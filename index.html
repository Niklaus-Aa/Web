<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Piyo Profile</title>

<script>
// æ¯å›é–‹ããŸã³ã«æ–°ã—ã„ãƒ•ã‚©ãƒ³ãƒˆãŒä½¿ç”¨ã•ã‚Œã‚‹ã‚ˆã†ã«ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹å‡¦ç†
(function() {
    // ç¾åœ¨æ™‚åˆ»ã‚’ãƒŸãƒªç§’ã§å–å¾—ã—ã€ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ã¦ä½¿ç”¨
    const timestamp = new Date().getTime(); 
    
    // @font-faceãƒ«ãƒ¼ãƒ«ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ–ã®ãŸã‚ã®ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¿½åŠ 
    const fontRules = `
        @font-face {
            font-family: 'Jfont';
            src: url('Jfont.woff?v=${timestamp}') format('woff');
            font-weight: normal;
            font-style: normal;
            font-display: swap; /* ãƒ•ã‚©ãƒ³ãƒˆã®èª­ã¿è¾¼ã¿ä¸­ã«ä»£æ›¿ãƒ•ã‚©ãƒ³ãƒˆã‚’è¡¨ç¤º */
        }
        @font-face {
            font-family: 'Efont';
            src: url('Efont.woff?v=${timestamp}') format('woff');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }
    `;
    
    // ã‚¹ã‚¿ã‚¤ãƒ«ã‚¿ã‚°ã‚’ä½œæˆã—ã€å®šç¾©ã—ãŸãƒ«ãƒ¼ãƒ«ã‚’<head>ã«æŒ¿å…¥
    const style = document.createElement('style');
    style.textContent = fontRules;
    document.head.appendChild(style);
})();
</script>

<style>
/* ---------------- åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« ---------------- */
*{margin:0;padding:0;box-sizing:border-box;}
body,html{
  width:100%;height:100%;overflow:hidden;
  /* ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚©ãƒ³ãƒˆã‚’é©ç”¨ */
  font-family:'Jfont','Efont',sans-serif;
  font-size:16px;color:white;background:#000;
  /* ãƒ•ã‚©ãƒ³ãƒˆã‚’æ»‘ã‚‰ã‹ã«ã™ã‚‹è¨­å®š */
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* ---------------- èƒŒæ™¯å‹•ç”» ---------------- */
#background-video{
  position:fixed; top:50%; left:50%;
  width:110%; height:110%;
  transform:translate3d(-50%,-50%,0) scale(1.1);
  object-fit:cover; z-index:0; will-change: transform;
  /* èƒŒæ™¯ã‚’æš—ãã™ã‚‹è¨­å®šã‚’å‰Šé™¤ã—ã€ãƒ–ãƒ©ãƒ¼ã®ã¿æ®‹ã™ */
  filter: blur(5px); 
}

/* ---------------- ä¸»è¦ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ ---------------- */
.center-box{
  position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
  text-align:center; z-index:2;
}
.icon{width:150px; height:150px; border-radius:50%; overflow:hidden; box-shadow:0 0 40px rgba(246,59,225,0.6);}
.name{margin-top:20px; font-size:32px; text-shadow:0 0 5px pink;}
.desc{margin-top:8px; font-size:28px; opacity:0.9; text-shadow:0 0 5px pink;}

/* è‹±æ–‡å­—ã ã‘å¤§ããã™ã‚‹ */
.english{
  /* ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚©ãƒ³ãƒˆã‚’é©ç”¨ */
  font-family:'Efont',sans-serif; 
  font-size:1.1em;
}

/* ---------------- ãƒŸãƒ¥ãƒ¼ã‚¸ãƒƒã‚¯ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ ---------------- */
.music-box{
  position:absolute; bottom:30px; right:30px; width:450px; height:140px;
  background:rgba(0,0,0,0.2); border-radius:25px; backdrop-filter:blur(10px);
  padding:15px 20px; color:white; box-shadow:0 0 30px rgba(0,0,0,0.7);
  display:flex; flex-direction:column; justify-content:space-between; z-index:2;
}
.music-info{font-size:20px;text-align:left;text-shadow:0 0 8px rgba(255,255,255,0.7);}
.controls{display:flex;justify-content:flex-end;gap:15px;margin-top:10px;}
/* ãƒœã‚¿ãƒ³ã‚’ç”»åƒå¯¾å¿œã«å¤‰æ›´: font-familyã¨ãƒ†ã‚­ã‚¹ãƒˆé–¢é€£ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å‰Šé™¤/ç„¡è¦– */
.control-button{width:35px;height:35px;border-radius:50%;border:none;background:rgba(255,255,255,0.3);
  backdrop-filter:blur(5px);cursor:pointer;box-shadow:0 0 10px rgba(0,0,0,0.5);
  display:flex;align-items:center;justify-content:center;transition: transform 0.1s;}
/* .control-button span.btn-textã¯ç”»åƒåŒ–ã«ä¼´ã„å‰Šé™¤/ç„¡è¦–ã—ã¾ã™ */

/* --- è¿½åŠ : ãƒœã‚¿ãƒ³å†…ã®ç”»åƒã‚¹ã‚¿ã‚¤ãƒ« --- */
.control-icon {
    /* ãƒœã‚¿ãƒ³æœ¬ä½“(35x35px)ã«åã¾ã‚‹ã‚ˆã†ã«ã‚µã‚¤ã‚ºã‚’è¨­å®š (700x700pxã®ç”»åƒã‚’ç¸®å°è¡¨ç¤º) */
    width: 60%; 
    height: 60%; 
    object-fit: contain;
    filter: drop-shadow(0 0 1px rgba(0,0,0,0.5));
}

.progress-container{width:100%;height:8px;background:rgba(255,255,255,0.2);border-radius:4px;overflow:hidden;margin-top:10px;cursor:pointer;position:relative;}
.progress-bar{width:0%;height:100%;background:rgba(255,255,255,0.7);border-radius:4px;}
.progress-knob{width:14px;height:14px;border-radius:50%;background:rgba(255,255,255,0.9);position:absolute;top:50%;transform:translate(-50%,-50%);cursor:pointer;}
.time-labels{display:flex;justify-content:space-between;font-size:16px;margin-top:3px;text-shadow:0 0 5px rgba(255,255,255,0.7);}
.time-labels span{animation: glow 1.5s infinite alternate;}
@keyframes glow{
  from{text-shadow:0 0 5px #fff;}
  to{text-shadow:0 0 15px #fff;}
}

/* ---------------- ä¸‹éƒ¨ãƒªãƒ³ã‚¯ / ãƒãƒ¼ã‚¸ãƒ§ãƒ³ ---------------- */
.links{position:absolute;bottom:20px;width:100%;text-align:center; z-index:2;}
.links img{width:40px;margin:0 10px;cursor:pointer;border-radius:50%;filter:drop-shadow(0 0 var(--link-shadow,5px) black);}
#version{
  position:absolute;bottom:20px;left:20px;color:white;
  /* é»’ã„glowã‚’é©ç”¨ */
  text-shadow:0 0 10px black, 0 0 5px black;
  font-size:18px; z-index:2;
}

/* ---------------- Enter Overlay ---------------- */
#enter-overlay{
  position:fixed; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.9); /* æš—ã•ã¯ç¶­æŒ */
  z-index:10;
  display:flex; justify-content:center; align-items:center;
  cursor:pointer;
  opacity:1; 
  /* ä¿®æ­£: transitionã‹ã‚‰transformã‚’å‰Šé™¤ */
  transition:opacity 0.5s ease, visibility 0.5s ease;
  visibility:visible;
}
.enter-text{
  font-size:48px; font-weight:bold;
  color:white;
  text-shadow:0 0 20px white;
  animation: none; /* pulseã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤ */
  /* è¿½åŠ : ãƒ†ã‚­ã‚¹ãƒˆã®ç¸®å°ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®ãŸã‚ã®transitionã‚’è¨­å®š */
  transition: transform 0.5s ease;
  transform: scale(1); /* åˆæœŸã‚¹ã‚±ãƒ¼ãƒ« */
}
</style>
</head>
<body>

<video id="background-video" autoplay loop muted playsinline>
  <source src="background.mp4" type="video/mp4">
</video>

<div id="enter-overlay">
  <div class="enter-text">Click to Enter!</div>
</div>

<div id="glow"></div>

<div class="center-box">
  <img src="icon.png" class="icon">
  <div class="name" id="name-text">ğ“—ğ“² ğ“½ğ“±ğ“®ğ“»ğ“®! ğ“˜'ğ“¶ ğ“¢ğ“±ğ“ªğ”‚ğ“ªğ“·</div>
  <div class="desc" id="desc-text">ğ“¦ğ“®ğ“µğ“¬ğ“¸ğ“¶ğ“®</div>
</div>

<div class="music-box">
  <div style="display:flex; justify-content:space-between; align-items:center;">
    <div class="music-info" id="current-music">---</div>
    <div class="controls">
      <button class="control-button" id="prev"><img src="prev.png" alt="Prev" class="control-icon"></button>
      <button class="control-button" id="play-pause"><img src="play.png" alt="Play" id="play-pause-icon" class="control-icon"></button>
      <button class="control-button" id="next"><img src="next.png" alt="Next" class="control-icon"></button>
    </div>
  </div>
  <div class="progress-container" id="progress-container">
    <div class="progress-bar" id="progress-bar"></div>
    <div class="progress-knob" id="progress-knob"></div>
  </div>
  <div class="time-labels">
    <span id="current-time">0:00</span>
    <span id="total-time">0:00</span>
  </div>
  <audio id="audio"></audio>
</div>

<div class="links" id="links-box"></div>
<div id="version">v1.0</div>

<script>
// ---------------- èƒŒæ™¯ãƒ‘ãƒ©ãƒ©ãƒƒã‚¯ã‚¹ ----------------
const bg = document.getElementById('background-video');
let mouseX=0, mouseY=0, currentX=0, currentY=0;
document.addEventListener('mousemove', e=>{
  mouseX=(e.clientX-window.innerWidth/2)*0.1;
  mouseY=(e.clientY-window.innerHeight/2)*0.1;
});
function animateBackground(){
  let dx=mouseX-currentX, dy=mouseY-currentY;
  let dist=Math.sqrt(dx*dx+dy*dy);
  let speed=dist>270?4:dist/270*4;
  if(dist>0){currentX+=dx/dist*speed; currentY+=dy/dist*speed;}
  bg.style.transform=`translate3d(calc(-50% + ${currentX}px), calc(-50% + ${currentY}px),0) scale(1.1)`;
  requestAnimationFrame(animateBackground);
}
animateBackground();

// ---------------- ãƒŸãƒ¥ãƒ¼ã‚¸ãƒƒã‚¯ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãªã© ----------------
fetch('config.json').then(r=>r.json()).then(cfg=>{
  const glow = document.getElementById('glow');
  const bgVideo = document.getElementById('background-video');
  const enterOverlay = document.getElementById('enter-overlay');

  // è¨­å®šã‹ã‚‰ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é©ç”¨
  glow.style.background=`rgb(${cfg.other.iconGlowColor})`;
  document.body.style.color=`rgb(${cfg.other.fontColor})`;
  document.getElementById('desc-text').innerText = cfg.other.description || '';
  document.getElementById('version').innerText = cfg.other.version || 'v1.0';

  // èƒŒæ™¯ã«ãƒ–ãƒ©ãƒ¼ã‚’è¨­å®š (æš—ã•è¨­å®šã‚’å‰Šé™¤)
  const blurValue = cfg.other.backgroundBlur || 5; 
  const activeFilter = `blur(${blurValue}px)`;
  
  // Enterå‰ã®CSSã§åˆæœŸãƒ–ãƒ©ãƒ¼ã‚’è¨­å®šæ¸ˆã¿ã ãŒã€å¿µã®ãŸã‚ã“ã“ã§ã‚‚è¨­å®š
  bgVideo.style.filter = activeFilter;


  // ãƒªãƒ³ã‚¯ç”Ÿæˆ
  const linkBox = document.getElementById('links-box');
  cfg.links.forEach(item=>{
    let url = item.url || item;
    let icon = item.icon || 'link.png';
    const a = document.createElement('a');
    a.href=url; a.target='_blank';
    a.innerHTML=`<img src="${icon}">`;
    if(item.shadow) {
        a.querySelector('img').style.setProperty('--link-shadow', `${item.shadow}px`);
    }
    linkBox.appendChild(a);
  });

  // éŸ³æ¥½
  const audio=document.getElementById('audio');
  const currentMusicText=document.getElementById('current-music');
  const progressBar=document.getElementById('progress-bar');
  const knob=document.getElementById('progress-knob');
  const playPauseBtn=document.getElementById('play-pause');
  const nextBtn=document.getElementById('next');
  const prevBtn=document.getElementById('prev');
  const currentTimeLabel=document.getElementById('current-time');
  const totalTimeLabel=document.getElementById('total-time');
  
  // â˜…è¿½åŠ : play/pauseãƒœã‚¿ãƒ³ã®ç”»åƒè¦ç´ ã‚’å–å¾—
  const playPauseIcon = document.getElementById('play-pause-icon'); 
  
  let list=cfg.musics, current=0;
  let hasPlayedOnce = false; 

  function getSongName(f){ return f.replace(/\.mp3$/i,''); }
  
  // â˜…å¤‰æ›´: ãƒœã‚¿ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆã§ã¯ãªãã€ç”»åƒã®srcã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã‚ˆã†ã«ä¿®æ­£
  function updatePlayPause(){ 
    // audio.pausedãŒtrueï¼ˆåœæ­¢ä¸­ï¼‰ãªã‚‰å†ç”Ÿç”»åƒ(play.png)ã€falseï¼ˆå†ç”Ÿä¸­ï¼‰ãªã‚‰ä¸€æ™‚åœæ­¢ç”»åƒ(pause.png)ã‚’è¡¨ç¤º
    playPauseIcon.src = audio.paused ? 'play.png' : 'pause.png'; 
    playPauseIcon.alt = audio.paused ? 'Play' : 'Pause'; 
  }

  function playMusic(index){
    current=index;
    audio.src=list[current];
    if(hasPlayedOnce) {
        audio.play().catch(e => console.error("Audio play failed:", e));
    }
    // æ›²åè¨­å®š
    if (list[current]) {
        currentMusicText.innerHTML = getSongName(list[current]).replace(/[A-Za-z0-9]/g, m=>`<span class="english">${m}</span>`);
    } else {
        currentMusicText.innerHTML = '---';
    }
    updatePlayPause();
  }
  
  // Enterç”»é¢ã‚¯ãƒªãƒƒã‚¯æ™‚ã®å‡¦ç†
  function enterOverlayClick() {
    if (list.length > 0) {
        hasPlayedOnce = true;
        playMusic(0);
    }
    // Enterè§£é™¤å¾Œã®èƒŒæ™¯ãƒ•ã‚£ãƒ«ã‚¿ã‚’é©ç”¨ï¼ˆæš—ã•ãªã—ã€ãƒ–ãƒ©ãƒ¼ã®ã¿ï¼‰
    bgVideo.style.filter = activeFilter;
    
    // ä¿®æ­£: ãƒ†ã‚­ã‚¹ãƒˆã®ã¿ã‚’ç¸®å°
    document.querySelector('.enter-text').style.transform = 'scale(0.5)';
    
    // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤å…¨ä½“ï¼ˆé»’ã„èƒŒæ™¯ï¼‰ã¯ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ
    enterOverlay.style.opacity = '0';
    enterOverlay.style.visibility = 'hidden';
    enterOverlay.removeEventListener('click', enterOverlayClick);
  }

  // Enterç”»é¢ã«ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™»éŒ²
  enterOverlay.addEventListener('click', enterOverlayClick);


  function formatTime(sec){ const m=Math.floor(sec/60); const s=Math.floor(sec%60); return `${m}:${s<10?'0'+s:s}`; }
  audio.addEventListener('loadedmetadata', ()=>{ totalTimeLabel.innerText=formatTime(audio.duration); });
  audio.addEventListener('timeupdate', ()=>{
    const percent=(audio.currentTime/audio.duration)*100;
    progressBar.style.width=percent+'%';
    knob.style.left=percent+'%';
    currentTimeLabel.innerText=formatTime(audio.currentTime);
  });

  // æ›²çµ‚äº†æ™‚ã«æ¬¡ã®æ›²
  audio.addEventListener('ended', ()=>{ playMusic((current+1)%list.length); });

  // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼æ“ä½œ (çœç•¥ãªã—)
  let dragging=false;
  knob.addEventListener('mousedown',()=>dragging=true);
  document.addEventListener('mouseup',()=>dragging=false);
  document.addEventListener('mousemove', e=>{
    if(dragging){
      const rect=document.getElementById('progress-container').getBoundingClientRect();
      let percent=(e.clientX-rect.left)/rect.width;
      percent=Math.max(0,Math.min(1,percent));
      audio.currentTime=percent*audio.duration;
    }
  });

  // å†ç”Ÿãƒ»åœæ­¢ãƒœã‚¿ãƒ³ (çœç•¥ãªã—)
  playPauseBtn.addEventListener('click', ()=>{
    if(audio.paused) audio.play(); else audio.pause();
    updatePlayPause();
  });
  nextBtn.addEventListener('click', ()=>{ playMusic((current+1)%list.length); });
  prevBtn.addEventListener('click', ()=>{ playMusic((current-1+list.length)%list.length); });
});
</script>

</body>
</html>
